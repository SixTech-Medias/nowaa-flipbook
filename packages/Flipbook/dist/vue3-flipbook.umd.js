(function(P,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(P=typeof globalThis<"u"?globalThis:P||self,t(P.Vue3Flipbook={},P.Vue))})(this,function(P,t){"use strict";var io=Object.defineProperty;var uo=(P,t,C)=>t in P?io(P,t,{enumerable:!0,configurable:!0,writable:!0,value:C}):P[t]=C;var et=(P,t,C)=>(uo(P,typeof t!="symbol"?t+"":t,C),C);/*! @license Rematrix v0.7.2

  	Copyright 2021 Julian Lloyd.

  	Permission is hereby granted, free of charge, to any person obtaining a copy
  	of this software and associated documentation files (the "Software"), to deal
  	in the Software without restriction, including without limitation the rights
  	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  	copies of the Software, and to permit persons to whom the Software is
  	furnished to do so, subject to the following conditions:

  	The above copyright notice and this permission notice shall be included in
  	all copies or substantial portions of the Software.

  	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
  	THE SOFTWARE.
  */function C(n){if(n&&n.constructor===Array){var e=n.filter(function(r){return typeof r=="number"}).filter(function(r){return!isNaN(r)});if(n.length===6&&e.length===6){var o=Y();return o[0]=e[0],o[1]=e[1],o[4]=e[2],o[5]=e[3],o[12]=e[4],o[13]=e[5],o}else if(n.length===16&&e.length===16)return n}throw new TypeError("Expected a `number[]` with length 6 or 16.")}function Y(){for(var n=[],e=0;e<16;e++)e%5==0?n.push(1):n.push(0);return n}function tt(n,e){for(var o=C(n),r=C(e),a=[],i=0;i<4;i++)for(var c=[o[i],o[i+4],o[i+8],o[i+12]],s=0;s<4;s++){var u=s*4,h=[r[u],r[u+1],r[u+2],r[u+3]],_=c[0]*h[0]+c[1]*h[1]+c[2]*h[2]+c[3]*h[3];a[i+u]=_}return a}function ot(n){var e=Y();return e[11]=-1/n,e}function at(n){var e=Math.PI/180*n,o=Y();return o[0]=o[10]=Math.cos(e),o[2]=o[8]=Math.sin(e),o[2]*=-1,o}function lt(n){return"matrix3d("+C(n).join(", ")+")"}function nt(n,e){var o=Y();return o[12]=n,e&&(o[13]=e),o}function rt(n,e,o){var r=Y();return n!==void 0&&e!==void 0&&o!==void 0&&(r[12]=n,r[13]=e,r[14]=o),r}class de{constructor(e){et(this,"m");e?this.m=[...e]:this.m=Y()}clone(){return new de(this.m)}multiply(e){this.m=tt(this.m,e)}perspective(e){this.multiply(ot(e))}transformX(e){return(e*this.m[0]+this.m[12])/(e*this.m[3]+this.m[15])}translate(e,o){this.multiply(nt(e,o))}translate3d(e,o,r){this.multiply(rt(e,o,r))}rotateY(e){this.multiply(at(e))}toString(){return lt(this.m)}}const st=(n,e,o)=>{let r=0;return n>.5&&(r=-(n-.5)*2*180),e==="left"&&(r=-r),o==="back"&&(r+=180),r},De=n=>Math.pow(n,2),it=n=>1-De(1-n),Ee=n=>n<.5?De(n*2)/2:.5+it((n-.5)*2)/2,ut=(n,e,o,r,a,i,c)=>{let s=o,u=!1;return r===1?a==="right"?n==="back"&&(u=!0,s=o-i):e==="left"?n==="back"?s=i-o:u=!0:n==="front"?s=i-o:u=!0:e==="left"?n==="back"?s=c/2:u=!0:n==="front"?s=c/2:u=!0,{pageX:s,originRight:u}},ct=(n,e,o,r,a,i,c)=>{const s=new de;return s.translate(r/2),s.perspective(a),s.translate(-r/2),s.translate(n,i),o&&(e&&s.translate(c),s.rotateY(o),e&&s.translate(-c)),s},pt=(n,e)=>{let o;n<.5?o=n*2*Math.PI:o=(1-(n-.5)*2)*Math.PI,o==0&&(o=1e-9);const r=e/o;return{theta:o,radius:r}},ft=(n,e,o)=>o?-n/Math.PI*180+e/2/Math.PI*180:e/2/Math.PI*180,gt=(n,e,o,r)=>{const a=[],i=[-.5,-.25,0,.25,.5];if(o<1){const c=1-o,s=i.map(u=>(1-Math.cos((n-e*u)/180*Math.PI))*c);a.push(`linear-gradient(to right, rgba(0, 0, 0, ${s[0]}), rgba(0, 0, 0, ${s[1]}) 25%, rgba(0, 0, 0, ${s[2]}) 50%, rgba(0, 0, 0, ${s[3]}) 75%, rgba(0, 0, 0, ${s[4]}))`)}if(r>0){const u=i.map(h=>Math.max(Math.cos((n+30-e*h)/180*Math.PI)**200,Math.cos((n-30-e*h)/180*Math.PI)**200));a.push(`linear-gradient(to right, rgba(255, 255, 255, ${u[0]*r}), rgba(255, 255, 255, ${u[1]*r}) 25%, rgba(255, 255, 255, ${u[2]*r}) 50%, rgba(255, 255, 255, ${u[3]*r}) 75%, rgba(255, 255, 255, ${u[4]*r}))`)}return a.join(",")},dt=(n,e,o,r,a)=>{let i=Math.sin(n)*e;o&&(i=a-i);let c=(1-Math.cos(n))*e;return r==="back"&&(c=-c),{x:i,z:c}};function mt(n,e){const o=t.getCurrentInstance();if(!o)throw new Error("useDrawer() can only be used inside setup() or functional components!");const r=o.props,a=t.ref(1);let i=0;const c=t.ref(!1),s=t.ref(0),u=t.ref(0),h=g=>{R.value&&(i+=1,r.zooms&&S(r.zooms[i],g))},_=g=>{F.value&&(i-=1,r.zooms&&S(r.zooms[i],g))},S=(g,w)=>{const M=n==null?void 0:n.value;if(M){let L,f;if(w){const O=M.getBoundingClientRect();L=w.pageX-O.left,f=w.pageY-O.top}else L=M.clientWidth/2,f=M.clientHeight/2;const I=a.value,B=g,V=M.scrollLeft,W=M.scrollTop,j=L+V,v=f+W,U=j/I*B-L,G=v/I*B-f,le=Date.now();c.value=!0,o==null||o.emit("zoom-start",g);const ne=()=>{requestAnimationFrame(()=>{const O=Date.now()-le;let N=O/r.zoomDuration;N=N>1?1:N,N=Ee(N),a.value=I+(B-I)*N,s.value=V+(U-V)*N,u.value=W+(G-W)*N,O<r.zoomDuration?ne():(o==null||o.emit("zoom-end",g),c.value=!1,a.value=g,s.value=U,u.value=G)})};ne(),B>1&&e(!0)}},$=g=>{i=(i+1)%r.zooms.length,S(r.zooms[i],g)},R=t.computed(()=>!c.value&&i<r.zooms.length-1),F=t.computed(()=>!c.value&&i>0);return{zoom:a,zooming:c,canZoomIn:R,canZoomOut:F,zoomIn:h,zoomOut:_,zoomAt:$,onWheel:(g,w)=>{r.wheel==="scroll"&&a.value>1&&!w&&n.value&&(s.value=n.value.scrollLeft+g.deltaX,u.value=n.value.scrollTop+g.deltaY,g.cancelable&&g.preventDefault()),r.wheel==="zoom"&&(g.deltaY>=100?(_(g),g.preventDefault()):g.deltaY<=-100&&(h(g),g.preventDefault()))},scrollLeft:s,scrollTop:u}}function ht(n,e,o){const r=t.ref({}),a=t.ref(0),i=t.ref(0),c=t.ref(),s=t.ref(null),u=t.ref(null),h=t.getCurrentInstance();if(!h)throw new Error("useDrawer() can only be used inside setup() or functional components!");const _=h.props,S=(m,g=!1)=>{var w,M;return m<1?"":g&&e.value>1&&!o.value?(m<_.pagesHiRes.length?(w=_.pagesHiRes)==null?void 0:w[m]:"")||"":(m<_.pages.length?(M=_.pages)==null?void 0:M[m]:"")||""},$=m=>{if(s.value===null)return m;if(r.value[m])return m;{const g=new Image;return g.onload=()=>{r.value[m]=!0},g.src=m,_.loadingImage||""}};return{imageWidth:s,imageHeight:u,pageUrl:S,loadImage:$,pageUrlLoading:(m,g=!1)=>{const w=S(m,g);return g&&e.value>1&&!o.value?w:w&&$(w)},didLoadImage:m=>{s.value===null&&(s.value=m.target.naturalWidth,u.value=m.target.naturalHeight,n()),c.value&&(++a.value>=i.value&&c.value(),c.value=void 0)}}}const k={silent:Number.NEGATIVE_INFINITY,fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,ready:3,start:3,box:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},Fe={silent:{level:-1},fatal:{level:k.fatal},error:{level:k.error},warn:{level:k.warn},log:{level:k.log},info:{level:k.info},success:{level:k.success},fail:{level:k.fail},ready:{level:k.info},start:{level:k.info},box:{level:k.info},debug:{level:k.debug},trace:{level:k.trace},verbose:{level:k.verbose}};function me(n){return n!==null&&typeof n=="object"}function he(n,e,o=".",r){if(!me(e))return he(n,{},o,r);const a=Object.assign({},e);for(const i in n){if(i==="__proto__"||i==="constructor")continue;const c=n[i];c!=null&&(r&&r(a,i,c,o)||(Array.isArray(c)&&Array.isArray(a[i])?a[i]=[...c,...a[i]]:me(c)&&me(a[i])?a[i]=he(c,a[i],(o?`${o}.`:"")+i.toString(),r):a[i]=c))}return a}function vt(n){return(...e)=>e.reduce((o,r)=>he(o,r,"",n),{})}const yt=vt();function wt(n){return Object.prototype.toString.call(n)==="[object Object]"}function bt(n){return!(!wt(n)||!n.message&&!n.args||n.stack)}let ve=!1;const Ne=[];class b{constructor(e={}){const o=e.types||Fe;this.options=yt({...e,defaults:{...e.defaults},level:ye(e.level,o),reporters:[...e.reporters||[]]},{types:Fe,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const r in o){const a={type:r,...this.options.defaults,...o[r]};this[r]=this._wrapLogFn(a),this[r].raw=this._wrapLogFn(a,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(e){this.options.level=ye(e,this.options.types,this.options.level)}prompt(e,o){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(e,o)}create(e){const o=new b({...this.options,...e});return this._mockFn&&o.mockTypes(this._mockFn),o}withDefaults(e){return this.create({...this.options,defaults:{...this.options.defaults,...e}})}withTag(e){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+e:e})}addReporter(e){return this.options.reporters.push(e),this}removeReporter(e){if(e){const o=this.options.reporters.indexOf(e);if(o>=0)return this.options.reporters.splice(o,1)}else this.options.reporters.splice(0);return this}setReporters(e){return this.options.reporters=Array.isArray(e)?e:[e],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const e in this.options.types)console["__"+e]||(console["__"+e]=console[e]),console[e]=this[e].raw}restoreConsole(){for(const e in this.options.types)console["__"+e]&&(console[e]=console["__"+e],delete console["__"+e])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(e,o){e&&(e.__write||(e.__write=e.write),e.write=r=>{this[o].raw(String(r).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(e){e&&e.__write&&(e.write=e.__write,delete e.__write)}pauseLogs(){ve=!0}resumeLogs(){ve=!1;const e=Ne.splice(0);for(const o of e)o[0]._logFn(o[1],o[2])}mockTypes(e){const o=e||this.options.mockFn;if(this._mockFn=o,typeof o=="function")for(const r in this.options.types)this[r]=o(r,this.options.types[r])||this[r],this[r].raw=this[r]}_wrapLogFn(e,o){return(...r)=>{if(ve){Ne.push([this,e,r,o]);return}return this._logFn(e,r,o)}}_logFn(e,o,r){if((e.level||0)>this.level)return!1;const a={date:new Date,args:[],...e,level:ye(e.level,this.options.types)};!r&&o.length===1&&bt(o[0])?Object.assign(a,o[0]):a.args=[...o],a.message&&(a.args.unshift(a.message),delete a.message),a.additional&&(Array.isArray(a.additional)||(a.additional=a.additional.split(`
`)),a.args.push(`
`+a.additional.join(`
`)),delete a.additional),a.type=typeof a.type=="string"?a.type.toLowerCase():"log",a.tag=typeof a.tag=="string"?a.tag:"";const i=(s=!1)=>{const u=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&u>0){const h=[...this._lastLog.object.args];u>1&&h.push(`(repeated ${u} times)`),this._log({...this._lastLog.object,args:h}),this._lastLog.count=1}s&&(this._lastLog.object=a,this._log(a))};clearTimeout(this._lastLog.timeout);const c=this._lastLog.time&&a.date?a.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=a.date,c<this.options.throttle)try{const s=JSON.stringify([a.type,a.tag,a.args]),u=this._lastLog.serialized===s;if(this._lastLog.serialized=s,u&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(i,this.options.throttle);return}}catch{}i(!0)}_log(e){for(const o of this.options.reporters)o.log(e,{options:this.options})}}function ye(n,e={},o=3){return n===void 0?o:typeof n=="number"?n:e[n]&&e[n].level!==void 0?e[n].level:o}b.prototype.add=b.prototype.addReporter,b.prototype.remove=b.prototype.removeReporter,b.prototype.clear=b.prototype.removeReporter,b.prototype.withScope=b.prototype.withTag,b.prototype.mock=b.prototype.mockTypes,b.prototype.pause=b.prototype.pauseLogs,b.prototype.resume=b.prototype.resumeLogs;function _t(n={}){return new b(n)}class Mt{constructor(e){this.options={...e},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(e){return e<1?console.__error||console.error:e===1?console.__warn||console.warn:console.__log||console.log}log(e){const o=this._getLogFn(e.level),r=e.type==="log"?"":e.type,a=e.tag||"",c=`
      background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,s=`%c${[a,r].filter(Boolean).join(":")}`;typeof e.args[0]=="string"?o(`${s}%c ${e.args[0]}`,c,"",...e.args.slice(1)):o(s,c,...e.args)}}function Ce(n={}){return _t({reporters:n.reporters||[new Mt({})],prompt(o,r={}){return r.type==="confirm"?Promise.resolve(confirm(o)):Promise.resolve(prompt(o))},...n})}Ce();const It={pages:{type:Array,required:!0},pagesHiRes:{type:Array,default:()=>[]},flipDuration:{type:Number,default:1e3},zoomDuration:{type:Number,default:500},zooms:{type:Array,default:()=>[1,2,4]},perspective:{type:Number,default:2400},nPolygons:{type:Number,default:10},ambient:{type:Number,default:.4},gloss:{type:Number,default:.6},swipeMin:{type:Number,default:3},singlePage:{type:Boolean,default:!1},forwardDirection:{validator:n=>n==="right"||n==="left",default:"right"},centering:{type:Boolean,default:!0},startPage:{type:Number,default:null},loadingImage:{type:String,default:"spinner"},clickToZoom:{type:Boolean,default:!0},dragToFlip:{type:Boolean,default:!0},wheel:{type:String,default:"scroll"},pageHotspots:{type:Object,default:()=>({})}},Lt={class:"vue3-flipbook"},Pt=["src"],kt=["src"],zt=["data-img"],ae=t.defineComponent({__name:"Flipbook",props:It,emits:["flip-left-start","flip-left-end","flip-right-start","flip-right-end","zoom-start","zoom-end"],setup(n,{emit:e}){const o=Ce({level:4});o.info("This will not be logged");const r=e,a=n,i=t.ref(0),c=t.ref(0),s=t.ref(0),u=t.ref(0),h=t.ref(0),_=t.ref(1),S=t.ref(null),$=t.ref(null),R=t.ref(0),F=t.ref(null),m=t.ref(!1),g=t.ref(!1),w=t.ref(1/0),M=t.ref(-1/0),L=t.ref(),f=t.reactive({progress:0,direction:"right",frontImage:"",backImage:"",auto:!1,opacity:1}),I=t.ref(0),B=t.ref(!1),V=t.ref(0),W=t.ref(0),j=(l=!1)=>{for(let p=u.value-3;p<=u.value+3;p++)we(p,!1);if(l)for(let p=u.value;p<u.value+s.value;p++){const d=a.pagesHiRes[p];d&&typeof d=="string"&&(new Image().src=d)}},{zoom:v,zooming:U,canZoomIn:G,canZoomOut:le,zoomIn:ne,zoomOut:O,zoomAt:N,onWheel:Tt,scrollLeft:Ae,scrollTop:$e}=mt(L,j),{imageWidth:J,imageHeight:re,pageUrl:x,loadImage:St,pageUrlLoading:we,didLoadImage:se}=ht(j,v,U),xt=t.computed(()=>({zoom:U.value||v.value>1,"drag-to-scroll":!m.value})),Dt=t.computed(()=>({cursor:Xe.value=="grabbing"?"grabbing":"auto"})),ie=t.computed(()=>a.forwardDirection==="left"?Re.value:Be.value),ue=t.computed(()=>a.forwardDirection==="right"?Re.value:Be.value),Et=t.computed(()=>a.pages[0]===null?a.pages.length-1:a.pages.length),Z=t.computed(()=>a.pages[0]!==null?u.value+1:Math.max(1,u.value)),Re=t.computed(()=>u.value<a.pages.length-s.value),Be=t.computed(()=>u.value>=s.value&&!(s.value===1&&!x(h.value-1))),K=t.computed(()=>a.forwardDirection==="right"||s.value===1?h.value:_.value),Q=t.computed(()=>a.forwardDirection==="right"||s.value===1?_.value:h.value),Ft=t.computed(()=>x(K.value)),Nt=t.computed(()=>x(Q.value)&&s.value===2),Ct=t.computed(()=>a.pageHotspots[K.value]||[]),At=t.computed(()=>a.pageHotspots[Q.value]||[]),Xe=t.computed(()=>F.value?F.value:a.clickToZoom&&G.value?"zoom-in":a.clickToZoom&&le.value?"zoom-out":a.dragToFlip?"grab":"auto"),q=t.computed(()=>(i.value-D.value*s.value)/2),X=t.computed(()=>(c.value-A.value)/2),$t=t.computed(()=>{let l=D.value/a.nPolygons;return l=Math.ceil(l+1/v.value),l+"px"}),Rt=t.computed(()=>A.value+"px"),Bt=t.computed(()=>`${D.value}px ${A.value}px`),Xt=t.computed(()=>We("front").concat(We("back"))),H=t.computed(()=>{if(s.value===1)return q.value;{let l;return x(K.value)?l=q.value:l=i.value/2,l<w.value?l:w.value}}),ee=t.computed(()=>{if(s.value===1)return i.value-q.value;{let l=x(Q.value)?i.value-q.value:i.value/2;return l>M.value?l:M.value}}),Ht=t.computed(()=>{let l=(ee.value-H.value)*v.value;return l<i.value?(H.value+(I.value??0))*v.value-(i.value-l)/2:(H.value+(I.value??0))*v.value}),Ot=t.computed(()=>{let l=(ee.value-H.value)*v.value;return l<i.value?(H.value+(I.value??0))*v.value-(i.value-l)/2:(ee.value+(I.value??0))*v.value-i.value}),Yt=t.computed(()=>{let l=A.value*v.value;return l<c.value?X.value*v.value-(c.value-l)/2:X.value*v.value}),Vt=t.computed(()=>{let l=A.value*v.value;return l<c.value?X.value*v.value-(c.value-l)/2:(X.value+A.value)*v.value-c.value});t.onMounted(()=>{_e(a.forwardDirection),be(),window.addEventListener("resize",be,{passive:!0}),v.value=a.zooms[0],o.info("props.startPage",a.startPage),Ue(a.startPage)}),t.onBeforeUnmount(()=>{window.removeEventListener("resize",be)});const He=t.computed(()=>{const l=i.value/s.value,p=J.value?l/J.value:1,d=re.value?c.value/re.value:1,y=p<d?p:d;return y<1?y:1}),D=t.computed(()=>J.value?Math.round(J.value*He.value):1),A=t.computed(()=>re.value?Math.round(re.value*He.value):1),be=()=>{const l=L.value;l&&(i.value=l.clientWidth,c.value=l.clientHeight,s.value=i.value>c.value&&!a.singlePage?2:1,s.value===2&&(u.value&=-2),Oe(),w.value=1/0,M.value=-1/0)},Oe=()=>{s.value===1&&u.value===0&&a.pages.length&&!x(0)&&u.value++},Ye=()=>{ie.value&&Me("left",!0)},Ve=()=>{ue.value&&Me("right",!0)},We=l=>{let p=f.progress,d=f.direction;s.value===1&&d!==a.forwardDirection&&(p=1-p,d=a.forwardDirection),f.opacity=s.value===1&&p>.7?1-(p-.7)/.3:1;let y=l==="front"?f.frontImage:f.backImage;o.info("flip.backImage",f.backImage),o.info("flip.frontImage",f.frontImage),o.info("face",l),o.info("image",y);const E=D.value/a.nPolygons,{pageX:z,originRight:T}=ut(l,d,q.value,s.value,a.forwardDirection,D.value,i.value),pe=st(p,d,l),oo=ct(z,T,pe,i.value,a.perspective,X.value,D.value),{theta:ke,radius:ao}=pt(p,D.value);let ze=0,Te=ke/a.nPolygons,te=ft(ke,Te,T),fe=Te/Math.PI*180;l==="back"&&(te=-te,fe=-fe),w.value=1/0,M.value=-1/0;const Ge=[];let Se=1/0,xe=-1/0;for(let ge=0;ge<a.nPolygons;ge++){const lo=`${ge/(a.nPolygons-1)*100}% 0px`,oe=oo.clone(),no=T?ke-ze:ze,{x:ro,z:Je}=dt(no,ao,T,l,D.value);oe.translate3d(ro,0,Je),oe.rotateY(-te);const Ke=oe.transformX(0),Qe=oe.transformX(E);Se=Math.min(Se,Ke,Qe),xe=Math.max(xe,Ke,Qe);const so=gt(pe-te,fe,a.ambient,a.gloss)||"";ze+=Te,te+=fe,Ge.push([`${l}${ge}`,y,so,lo,oe.toString(),Math.abs(Math.round(Je))])}return M.value=xe,w.value=Se,Ge},_e=l=>{l!==a.forwardDirection?(f.frontImage=s.value===1?x(u.value-1):x(h.value),f.backImage=s.value===1?"":x(u.value-s.value+1)):(f.frontImage=s.value===1?x(u.value):x(_.value),f.backImage=s.value===1?"":x(u.value+s.value))},Me=(l,p)=>{_e(l),f.direction=l,f.progress=0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{f.direction!==a.forwardDirection?s.value===2&&(h.value=u.value-s.value):s.value===1?h.value=u.value+s.value:_.value=u.value+1+s.value,p&&Ze(!0)})})},Ze=l=>{const p=Date.now(),d=a.flipDuration*(1-f.progress),y=f.progress;f.auto=!0,f.direction==="left"?r("flip-left-start",Z.value):r("flip-right-start",Z.value);const E=()=>{const z=Date.now()-p;let T=y+z/d;T=T>1?1:T,f.progress=l?Ee(T):T,T<1?requestAnimationFrame(E):(f.direction!==a.forwardDirection?u.value-=s.value:u.value+=s.value,f.direction==="left"?r("flip-left-end",Z.value):r("flip-right-end",Z.value),f.auto=!1)};E()},Wt=()=>{const l=Date.now(),p=a.flipDuration*f.progress,d=f.progress;f.auto=!0;const y=()=>{requestAnimationFrame(()=>{const E=Date.now()-l;let z=d-d*E/p;z=z<0?0:z,f.progress=z,z>0?y():(h.value=u.value,_.value=u.value+1,f.auto=!1)})};y()},Zt=(l,p)=>{Ae.value=V.value-l,$e.value=W.value-p},qt=t.computed(()=>Math.min(Ot.value,Math.max(Ht.value,Ae.value))),jt=t.computed(()=>Math.min(Vt.value,Math.max(Yt.value,$e.value)));t.watch(qt,l=>{L.value&&(L.value.scrollLeft=l)}),t.watch(jt,l=>{L.value&&(L.value.scrollTop=l)});const Ie=l=>{L.value&&(S.value=l.pageX,$.value=l.pageY,R.value=0,v.value<=1?a.dragToFlip&&(F.value="grab"):(V.value=L.value.scrollLeft,W.value=L.value.scrollTop,F.value="all-scroll"))},Le=l=>{if(!S.value||!$.value)return;const p=l.pageX-S.value,d=l.pageY-$.value;if(R.value=Math.max(R.value,Math.abs(p),Math.abs(d)),v.value>1){Zt(p,d);return}if(!a.dragToFlip||Math.abs(d)>Math.abs(p))return;F.value="grabbing";const y=p>0?"left":"right",E=p>0?ie.value:ue.value,z=p>0?a.swipeMin:-a.swipeMin;return E&&p>=z&&Me(y,!1),f.direction===y&&(f.progress=Math.abs(p)/D.value,f.progress>1&&(f.progress=1)),!0},Pe=l=>{S.value&&(a.clickToZoom&&R.value<a.swipeMin&&N(l),f.direction!==null&&!f.auto&&(f.progress>1/4?Ze(!1):Wt()),S.value=null,F.value=null)},Ut=l=>{m.value=!0,Ie(l.changedTouches[0])},Gt=l=>{Le(l.changedTouches[0])&&l.preventDefault()},qe=l=>{Pe(l.changedTouches[0])},Jt=l=>{g.value=!0,!m.value&&l.button===0&&(Ie(l),l.target&&l.target.setPointerCapture(l.pointerId))},Kt=l=>{m.value||Le(l)},je=l=>{m.value||(Pe(l),l.target&&l.target.releasePointerCapture(l.pointerId))},Qt=l=>{m.value||g.value||l.button===0&&Ie(l)},eo=l=>{(!m.value||!g.value)&&Le(l)},to=l=>{(!m.value||!g.value)&&Pe(l)},Ue=l=>{l===null||l===Z.value||(u.value=(a.pages??[])[0]===null&&s.value===2&&l===1?0:l-1,w.value=1/0,M.value=-1/0,I.value=ce.value)};t.watch(u,()=>{h.value=u.value,_.value=u.value+1,j()});const ce=t.computed(()=>a.centering?Math.round(i.value/2-(H.value+ee.value)/2):0);return t.watch(ce,l=>{if(B.value)return;I.value===0&&J.value!==null&&(I.value=l);const p=()=>{requestAnimationFrame(()=>{const y=ce.value-I.value;Math.abs(y)<.5?(I.value=ce.value,B.value=!1):(I.value+=y*.1,p())})};B.value=!0,p()}),t.watch(()=>a.pages,(l,p)=>{_e(a.forwardDirection),Oe(),!(p!=null&&p.length)&&(l!=null&&l.length)&&a.startPage>1&&l[0]==null&&u.value++}),t.watch(()=>a.startPage,l=>{Ue(l)}),(l,p)=>(t.openBlock(),t.createElementBlock("div",Lt,[t.renderSlot(l.$slots,"default",t.normalizeProps(t.guardReactiveProps({canFlipLeft:ie.value,canFlipRight:ue.value,canZoomIn:t.unref(G),canZoomOut:t.unref(le),page:Z.value,numPages:Et.value,flipLeft:Ye,flipRight:Ve,zoomIn:t.unref(ne),zoomOut:t.unref(O)}))),t.createElementVNode("div",{ref_key:"refViewport",ref:L,class:t.normalizeClass(["viewport",xt.value]),style:t.normalizeStyle(Dt.value),onTouchmove:Gt,onPointermove:Kt,onMousemove:eo,onTouchend:qe,onTouchcancel:qe,onPointerup:je,onPointercancel:je,onMouseup:to,onWheel:p[2]||(p[2]=d=>t.unref(Tt)(d,m.value))},[t.createElementVNode("div",{class:"flipbook-container",style:t.normalizeStyle({transform:`scale(${t.unref(v)})`})},[t.createElementVNode("div",{class:"click-to-flip left",style:t.normalizeStyle({cursor:ie.value?"pointer":"auto"}),onClick:Ye},null,4),t.createElementVNode("div",{class:"click-to-flip right",style:t.normalizeStyle({cursor:ue.value?"pointer":"auto"}),onClick:Ve},null,4),t.createElementVNode("div",{style:t.normalizeStyle({transform:`translateX(${I.value}px)`})},[Ft.value?(t.openBlock(),t.createElementBlock("div",{key:0,class:"page-container fixed",style:t.normalizeStyle({width:D.value+"px",height:A.value+"px",left:q.value+"px",top:X.value+"px",position:"absolute"})},[t.createElementVNode("img",{class:"page-image",style:{width:"100%",height:"100%"},src:t.unref(we)(K.value,!0),onLoad:p[0]||(p[0]=(...d)=>t.unref(se)&&t.unref(se)(...d))},null,40,Pt),t.createElementVNode("div",{class:"page-hotspots",style:t.normalizeStyle({opacity:1-f.opacity,pointerEvents:f.opacity>.1?"none":"auto",zIndex:f.opacity>.1?1:10})},[t.renderSlot(l.$slots,"hotspot",{hotspots:Ct.value,page:K.value})],4)],4)):t.createCommentVNode("",!0),Nt.value?(t.openBlock(),t.createElementBlock("div",{key:1,class:"page-container fixed",style:t.normalizeStyle({width:D.value+"px",height:A.value+"px",left:i.value/2+"px",top:X.value+"px",position:"absolute"})},[t.createElementVNode("img",{class:"page-image",style:{width:"100%",height:"100%"},src:t.unref(we)(Q.value,!0),onLoad:p[1]||(p[1]=(...d)=>t.unref(se)&&t.unref(se)(...d))},null,40,kt),t.createElementVNode("div",{class:"page-hotspots",style:t.normalizeStyle({opacity:1-f.opacity,pointerEvents:f.opacity>.1?"none":"auto",zIndex:f.opacity>.1?1:10})},[t.renderSlot(l.$slots,"hotspot",{hotspots:At.value,page:Q.value})],4)],4)):t.createCommentVNode("",!0),t.createElementVNode("div",{style:t.normalizeStyle({opacity:f.opacity})},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(Xt.value,([d,y,E,z,T,pe])=>(t.openBlock(),t.createElementBlock("div",{key:d,class:t.normalizeClass(["polygon",{blank:!y}]),"data-img":y,style:t.normalizeStyle({backgroundImage:y&&`url(${t.unref(St)(y)})`,backgroundSize:Bt.value,backgroundPosition:z,width:$t.value,height:Rt.value,transform:T,zIndex:pe})},[t.withDirectives(t.createElementVNode("div",{class:"lighting",style:t.normalizeStyle({backgroundImage:E})},null,4),[[t.vShow,E.length]])],14,zt))),128))],4),t.createElementVNode("div",{class:"bounding-box",style:t.normalizeStyle({left:H.value+"px",top:X.value+"px",width:ee.value-H.value+"px",height:A.value+"px",cursor:Xe.value}),onTouchstart:Ut,onPointerdown:Jt,onMousedown:Qt},null,36)],4)],4)],38)]))}});ae.install=n=>(n.component(ae.name,ae),n),P.default=ae,Object.defineProperties(P,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=vue3-flipbook.umd.js.map
